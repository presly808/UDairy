<!DOCTYPE html>
<!-- saved from url=(0030)http://127.0.0.1:5000/register -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Sign Up | UDairy</title>
    <link rel="stylesheet" type="text/css" href="/view/css/style.css">
</head>

<body>
<div id="touchvpn_icon_container" class="disconnected" draggable="true"
     style="right: 1.09809663% !important; bottom: 2.55102041% !important;">
    <div id="touchvpn_status_icon" class="touchvpn_de"></div>
</div>

<div class="page">
    <h1>UDairy</h1>
    <div class="navigation">

        <a href="/view/html/sign-up.html">sign up</a>
        <a href="/view/html/sign-in.html">sign in</a>

    </div>

    <div class="body">

        <h2>Sign Up</h2>

        <form id="registerForm" action="/register" method="post">
            <dl>
                <dt>Username:</dt>
                <dd><input id="username" type="text" name="username" size="30" value=""></dd>
                <dt>E-Mail:</dt>
                <dd><input id="email" type="text" name="email" size="30" value=""></dd>
                <dt>Password:</dt>
                <dd><input id="pass" type="password" name="password" size="30"></dd>
                
                <dt id="wrongConfirmPass" style="color: red; display: none;">!</dt>

                <dt>Confirm password:</dt>
                <dd><input id="confPass" type="password" name="confirmPassword" size="30"></dd>
            </dl>
        </form>
        <div class="actions"><input id="submitButton" type="button" value="Sign Up"></div>

    </div>

    <div class="footer">
        UDairy
    </div>
</div>

<script>

  function sendRegisterForm(){
    var username = document.getElementById("username").value;
    var pass = document.getElementById("pass").value;
    var confPass = document.getElementById("confPass").value;
    var email = document.getElementById("email").value;
    var emailValidator = /^[-._a-z0-9]+@(?:[a-z0-9][-a-z0-9]+\.)+[a-z]{2,6}$/;

    if(!emailValidator.test(email)){
      document.getElementById('wrongConfirmPass').style.display = "inline";
      document.getElementById('wrongConfirmPass').innerHTML = "Sorry, but entered E-Mail is not correct. Please try again";
      document.getElementById("email").focus();
      return false;

    } else if(pass == "" || pass != confPass){
      
      document.getElementById('wrongConfirmPass').style.display = "inline";
      document.getElementById('wrongConfirmPass').innerHTML = "Sorry, but yours passwords are not the same. Please try again";
      document.getElementById("pass").value = "";
      document.getElementById("confPass").value = "";
      document.getElementById("pass").focus();
      return false;

    } else {

      var obj = {username : username, email : email, pass: pass};
      
      // construct an HTTP request
      var xhr = new XMLHttpRequest();
      xhr.open("POST", "/register", true);
      xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');

      // send the collected data as JSON
      xhr.send(JSON.stringify(obj));

      xhr.onloadend = function (resp) {
        console.log("req has been sucessful\n" + resp);
        window.location.replace("/view/html/sign-in.html");
      };
    }
  };


  function init() {
    document.getElementById("submitButton")
      .addEventListener("click", sendRegisterForm);
  }
  // add listener to button
  // get form
  // toJson
  // sendToServer

  document.addEventListener("DOMContentLoaded", init);
</script>


</body>

</html>
